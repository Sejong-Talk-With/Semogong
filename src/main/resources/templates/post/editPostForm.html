<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header"/>
<body>

<!-- Responsive navbar-->
<nav th:replace="fragments/navbar :: navbar"/>

<div class="container" style="padding-top: 10px">
    <iframe id="iframe1" name="iframe1" style="display:none"></iframe>
    <form role="form" th:action="@{/posts/edit/{id}/img (id=${postForm.id})}" target="iframe1" method="post"
          enctype="multipart/form-data">
        <label class="form-label" th:for="image" style="display: inline-block">배경 이미지</label>
        <div th:if="${postForm.image != null}" style="display: inline-block"> ( 현재 <p class="mb-0" style="display: inline-block"
                                                                                      th:text="${postForm.image.imgName}"></p>
            로 설정 되어 있습니다. 수정을 원하신다면 파일을 새로 선택 후 Upload 버튼을 눌러주세요.)
        </div>
        <div class="form-label" th:if="${postForm.image == null}" style="display: inline-block"> ( 썸네일 선택 후 Upload 버튼을
            눌러주세요!)
        </div>
        <div class="input-group mb-3">
            <div class="input-group">
                <img class="mb-2 img-thumbnail" height="150px" width="270px" th:if="${postForm.image != null}" th:src="${postForm.image.imgSrc}" alt="profile">
                <img class="img-thumbnail"  height="150px" width="270px" th:if="${postForm.image == null}" src="/images/profile.png">
            </div>
            <div class="input-group">
                <button class="btn btn-outline-secondary" type="submit" id="inputGroupFileAddon04" onclick="upload_check()">Upload</button>
                <input class="form-control" name="file" type="file" accept=".jpg, .png">
            </div>
        </div>
    </form>
    <form role="form" th:object="${postForm}" method="post">
        <!-- id -->
        <input type="hidden" th:field="*{id}"/>
        <div>
            <label class="form-label" th:for="times"> 학습 시간 </label>
            <div class="card-text mb-3">
                <th:block th:id="timeNum+${i}" th:each="i: ${#numbers.sequence(0, #lists.size(postForm.times)-1)}">
                    <div style="display: inline-block; flex: 0 0 auto; width: 70px;">
                        <input type="text" th:field="*{times[__${iStat.index}__]}" class="form-control">
                    </div>
                    <p class="mb-0" style="display: inline-block" th:if="${i % 2 == 0}">~</p>
                    <p class="mb-0" style="display: inline-block" th:if="${i % 2 != 0}">&nbsp;&nbsp;</p>
                </th:block>
            </div>
        </div>
        <label class="form-label" th:for="title">제목 *</label>
        <div class="input-group mb-3 has-validation">
            <input type="text" th:field="*{title}" class="form-control" placeholder="제목을 입력하세요!" autocomplete="off"
                   th:class="${#fields.hasErrors('title')}? 'form-control is-invalid' : 'form-control'">
            <div th:if="${#fields.hasErrors('title')}" class="invalid-feedback" th:errors="*{title}">Incorrect date
            </div>
        </div>
        <label class="form-label" th:for="nickname">오늘의 한 줄</label>
        <div class="input-group mb-3">
            <input type="text" th:field="*{introduce}" class="form-control"
                   placeholder="오늘 하루를 정리하는 문장을 적어주세요!">
        </div>
        <label class="form-label" th:for="content">내용</label>
        <div class="mb-2">
            <textarea type="text" rows="4" th:field="*{content}" placeholder="Content" class="form-control"
                      autocomplete="off"></textarea>
        </div>
<!--        <div id="editor" class="mb-4"></div>-->

        <div class="d-sm-flex justify-content-between mb-4">
            <button class="btn btn-danger" type="button"
                    th:onclick="|javascript:delete_check(${postForm.id})|">Delete</button>
            <button class="btn btn-primary" type="submit">Submit</button>
        </div>
    </form>
</div>

<div th:replace="fragments/footer :: footer"/>

<!-- Toast MDE CDN -->
<!--<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>-->


<script th:inline="javascript" type="text/javascript">
    var simplemde = new SimpleMDE({element: document.getElementById("content")});

    function delete_check(id) {
        var check = confirm("정말 삭제하시겠습니까??");
        if (check){    //확인
            alert("삭제가 완료 되었습니다.")
            location.href = "/posts/delete/"+id;
            // fetch(`/posts/delete/${id}`)
            //     .then((response) => location.href = response.url);
        }else{   //취소
            return false;
        }
    }

    function upload_check() {
        setTimeout(function(){alert("Upload완료 되었습니다!");location.reload();},500);
    }


    /*    /!*<![CDATA[*!/
        var content = [[ ${postForm.content}]];
        /!*]]*!/

        const editor = new toastui.Editor({
            el: document.querySelector('#editor'),
            height: '500px',
            initialEditType: 'markdown',
            previewStyle: 'vertical',
            initialValue: content
        });

        // content = editor.getMarkdown();
        // var html = editor.getHTML();         */



</script>

</body>
</html>